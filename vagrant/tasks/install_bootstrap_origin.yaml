---
- name: Detect EPEL
  stat:
    path: /etc/yum.repos.d/epel.repo
  register: epel
- name: Detecting Operating System
  stat:
    path: /run/ostree-booted
  register: ostree_booted
- package:
    name: https://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-8.noarch.rpm
    state: present
  when: not epel.stat.exists
- package:
    name: "{{ item }}"
    state: present
  with_items:
   - git
   - ansible
   - pyOpenSSL
  # For now, since ansible's `pkg` module doesn't know about rpm-ostree
  when: not ostree_booted.stat.exists

# TODO: merge these when atomichost branch is merged
- git:
    repo: https://github.com/openshift/openshift-ansible
    dest: ~/openshift-ansible
    force: yes
    update: yes
  become: yes
  become_user: vagrant
  when: not ostree_booted.stat.exists
- git:
    repo: https://github.com/cgwalters/openshift-ansible
    version: atomichost
    dest: ~/openshift-ansible
    force: yes
    update: yes
  become: yes
  become_user: vagrant
  when: ostree_booted.stat.exists
